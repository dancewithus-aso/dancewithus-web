// ----------- ADMIN: VER Y APROBAR SOLICITUDES -----------
async function cargarSolicitudes(){
  const { db, collection, query, getDocs, deleteDoc, addDoc, serverTimestamp } = window.firebase;
  const qSnap = await getDocs(collection(db,'membershipRequests'));
  const list = qs('#admin-solicitudes-list');
  list.innerHTML='';
  qSnap.forEach(doc=>{
    const d=doc.data();
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <strong>${d.nombre}</strong> (${d.modalidad})<br/>
      <span class="muted">${d.email} · ${d.telefono||''}</span><br/>
      <em>${d.mensaje||''}</em><br/>
      <button class="btn primary" onclick="aprobar('${doc.id}')">Aprobar</button>`;
    list.appendChild(card);
  });
}
async function aprobar(id){
  const { db, collection, getDoc, doc, deleteDoc, addDoc, serverTimestamp } = window.firebase;
  const snap = await getDoc(doc(db,'membershipRequests',id));
  if(!snap.exists()) return alert('Solicitud no encontrada');
  const data=snap.data();
  // Crear usuario
  await addDoc(collection(db,'users'),{
    nombre:data.nombre,
    email:data.email,
    telefono:data.telefono||'',
    modalidad:data.modalidad,
    rol:'socio',
    createdAt:serverTimestamp()
  });
  // Borrar solicitud
  await deleteDoc(doc(db,'membershipRequests',id));
  cargarSolicitudes();
  alert('Socio aprobado y añadido a la lista.');
}
// Llamar al cargar el panel admin
qs('#admin-panels').addEventListener('DOMNodeInserted',()=>cargarSolicitudes(),{once:true});
